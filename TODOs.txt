# TODO merge my two forks or start committing or something?
# TODO clear space on lightning and wandb, 
# TODO maybe don't save models to wandb?
# TODO understand when voice says episode over, it stops recording then, so can I reset sock position with arm or? 
# TODO ACT and smolVLA FPS. That matters right?
# TODO evaluate smolVLA, diffusion. 
# TODO train diffusion and compare to others
# TODO do train eval splits
# TODO how to save bashrc on lightning? probably just bashrc somewhere. lightning using fork
# TODO create jupyter notebooks instead of bash scripts
# TODO ville act feature detector
# TODO understand shreyas code
# TODO bigger batch size...?
# TODO IK
# TODO MCP
# omg i should focus on this, 100% accuracy in everything... and if not 100%, then just feed more data and train and intervene. 
# TODO HL-SERL
https://chatgpt.com/share/6856946e-157c-8002-87c0-396f8bce16a9
# TODO hl-serl simulation https://huggingface.co/docs/lerobot/hilserl_sim. nvidia
# TODO control arm in simulation with leader, get so-100 in sim
# train and evaluate in sim, train in both? how did russ tedrake do it?

# TODO profile policy. at end of README:
from torch.profiler import profile, record_function, ProfilerActivity

def trace_handler(prof):
    prof.export_chrome_trace(f"tmp/trace_schedule_{prof.step_num}.json")

with profile(
    activities=[ProfilerActivity.CPU, ProfilerActivity.CUDA],
    schedule=torch.profiler.schedule(
        wait=2,
        warmup=2,
        active=3,
    ),
    on_trace_ready=trace_handler
) as prof:
    with record_function("eval_policy"):
        for i in range(num_episodes):
            prof.step()
            # insert code to profile, potentially whole body of eval_policy function




# TODO run and fix and study all test pytests

=============================== short test summary info ===============================
FAILED tests/cameras/test_opencv.py::test_read[128x128] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_read[160x120] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_read[320x180] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_read[480x270] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_async_read[128x128] - TimeoutError: Timed out waiting for frame from camera OpenCVCamera(/home/ben/all_p...
FAILED tests/cameras/test_opencv.py::test_async_read[160x120] - TimeoutError: Timed out waiting for frame from camera OpenCVCamera(/home/ben/all_p...
FAILED tests/cameras/test_opencv.py::test_async_read[320x180] - TimeoutError: Timed out waiting for frame from camera OpenCVCamera(/home/ben/all_p...
FAILED tests/cameras/test_opencv.py::test_async_read[480x270] - TimeoutError: Timed out waiting for frame from camera OpenCVCamera(/home/ben/all_p...
FAILED tests/cameras/test_opencv.py::test_rotation[no_rot-128x128] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[no_rot-160x120] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[no_rot-320x180] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[no_rot-480x270] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot90-128x128] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot90-160x120] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot90-320x180] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot90-480x270] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot180-128x128] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot180-160x120] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot180-320x180] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot180-480x270] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot270-128x128] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot270-160x120] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot270-320x180] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/cameras/test_opencv.py::test_rotation[rot270-480x270] - RuntimeError: OpenCVCamera(/home/ben/all_projects/lerobot/tests/artifacts/cameras/...
FAILED tests/datasets/test_datasets.py::test_backward_compatibility[lerobot/pusht] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
FAILED tests/datasets/test_datasets.py::test_backward_compatibility[lerobot/aloha_sim_insertion_human] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
FAILED tests/datasets/test_datasets.py::test_backward_compatibility[lerobot/xarm_lift_medium] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
FAILED tests/policies/test_policies.py::test_backward_compatibility[lerobot/xarm_lift_medium-tdmpc-policy_kwargs0-use_policy] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
FAILED tests/policies/test_policies.py::test_backward_compatibility[lerobot/pusht-diffusion-policy_kwargs1-] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
FAILED tests/policies/test_policies.py::test_backward_compatibility[lerobot/aloha_sim_insertion_human-act-policy_kwargs2-] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
FAILED tests/policies/test_policies.py::test_backward_compatibility[lerobot/aloha_sim_insertion_human-act-policy_kwargs3-1000_steps] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
FAILED tests/rl/test_actor.py::test_establish_learner_connection_success - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor.py::test_establish_learner_connection_failure - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor.py::test_push_transitions_to_transport_queue - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor.py::test_transitions_stream - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor.py::test_interactions_stream - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor_learner.py::test_end_to_end_transitions_flow - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor_learner.py::test_end_to_end_interactions_flow - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor_learner.py::test_end_to_end_parameters_flow[small] - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_actor_learner.py::test_end_to_end_parameters_flow[large] - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_learner_service.py::test_send_interactions - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_learner_service.py::test_send_transitions - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_learner_service.py::test_send_transitions_empty_stream - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_learner_service.py::test_stream_parameters - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_learner_service.py::test_stream_parameters_with_shutdown - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
FAILED tests/rl/test_learner_service.py::test_stream_parameters_waits_and_retries_on_empty_queue - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
ERROR examples/test_feetech_motor.py::test_motor_movement
ERROR tests/datasets/test_image_transforms.py::test_backward_compatibility_single_transforms[ColorJitter-brightness-min_max_values0] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
ERROR tests/datasets/test_image_transforms.py::test_backward_compatibility_single_transforms[ColorJitter-contrast-min_max_values1] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
ERROR tests/datasets/test_image_transforms.py::test_backward_compatibility_single_transforms[ColorJitter-saturation-min_max_values2] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
ERROR tests/datasets/test_image_transforms.py::test_backward_compatibility_single_transforms[ColorJitter-hue-min_max_values3] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
ERROR tests/datasets/test_image_transforms.py::test_backward_compatibility_single_transforms[SharpnessJitter-sharpness-min_max_values4] - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
ERROR tests/datasets/test_image_transforms.py::test_backward_compatibility_default_config - safetensors_rust.SafetensorError: Error while deserializing header: HeaderTooLarge
ERROR tests/rl/test_learner_service.py::test_ready_method - RuntimeError: The grpc package installed is at version 1.70.0, but the generated c...
==== 46 failed, 564 passed, 17 skipped, 25 warnings, 8 errors
